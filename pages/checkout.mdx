# Checkout

Explora como se ve una integración con Agotao Checkout. El código del lado del cliente y del servidor redirige a tu usuario a una página de pago en Agotao.

Los metodos de pago aceptados son transferencias BBVA, Yape, BCP, Yape, Plin

## A hackear

Desde tu servidor crea una checkout session. Las checkout sessions son validas durante 15 minutos, si tu cliente no realiza el pago, la checkout sesion expira y ya no puede ser utilizada.

```js filename="server.js"
const express = require('express');
const app = express();
app.use(express.static('public'));

const YOUR_DOMAIN = 'http://localhost:4242';

app.post('/create-checkout-session', async (req, res) => {
  const session = await axios.post(
    'https://api.agotao.com/api/v1/checkout/sessions',
    {
      items: [
        {
          product_id: 'product1', // encuentra el id de tu producto en tu dashboard de Agotao
          quantity: 2,
        },
        {
          product_id: 'product2',
          quantity: 3,
        },
      ],
      success_url: 'https://your-success-url.com',
      cancel_url: 'https://your-cancel-url.com', // optional
      metadata: {
        // opcional
        order_id: '123456',
        custom_field: 'custom_value',
      },
    },
    {
      headers: {
        Authorization: 'Bearer SECRET_KEY', // encuentra tu secret key en tu dashboard de Agotao
        'Content-Type': 'application/json',
      },
    }
  );

  res.redirect(303, session.url); // redirige a la pagina de pago
});

app.listen(4242, () => console.log('Running on port 4242'));
```

La respuesta de la API <code>/checkout/sessions</code> tiene la siguiente estructura:

```json
{
  "url": "https://checkout.agotao.com/c/clcy3rln00004c88icj8szgpp",
  "success_url": "www.google.com",
  "cancel_url": "www.agotao.com",
  "expires_at": "2023-01-16T01:18:30.629Z",
  "payment_status": "UNPAID",
  "status": "VALID",
  "metadata": {
    "objeto": "con tu metadata"
  }
}
```

Cuando envíes al usuario a la URL de pago, el usuario puede completar el pago con una de las opciones de pago disponibles. Si el pago es exitoso, el usuario será redirigido a la URL de éxito.
